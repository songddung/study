# chapter 4


## 키워드
- ALU : 레지스터로부터 피연산자를 받고, 제어장치로부터 제어 신호 받음
  - 연산 결과와 플래그 output
- 제어장치는 클럭, 현재 수행할 명령어, 플래그, 제어 신호 받음
  - cpu 내부와 외부로 제어 신호 output

- 프로그램 카운터 : 메모리에서 가져올 명령어 주소 저장
- 명령어 레지스터 : 해석할 명령어를 저장
- 메모리 주소 레지스터 : 메모리의 주소 저장
- 메모리 버퍼 레지스터 : 메모리와 주고 받을 데이터 저장
- 범용 레지스터 : 데이터와 주소 모두 저장
- 플래그 레지스터 : 연산 결과 혹은 CPU 상태에 대한 부가 정보 저장
- 스택 포인터 : 스택 최상단 위치
- 베이스 레지스터 : 저장된 주소는 기준 주소로서의 역할


- 명령어 사이클 : 하나의 명령어가 처리되는 주기
  - 구성
    - 인출
    - 실행
    - 간접
    - 인터럽트 사이클
    
- 인터럽트 : CPU의 정상적인 작업을 방해하는 신호
  - 종류
    - 예외(동기 입터럽트)
    - 하드웨어 인터럽트(비동기 인터럽트)
    
  - 인터럽트 서비스 루틴 : 인터럽트를 처리하기 위한 동작들로 이루어진 프로그램


### ALU와 제어장치
- CPU 구성 요소
  - ALU
  - 제어장치
  - 레지스터

- ALU 연산
  - 입력
    - 레지스터를 통해 피연산자 받기
    - 제어장치로부터 수행할 연산을 알려주는 제어 신호 받기
    - 연산
  - 출력
    - 특정 숫자, 문자, 메모리 주소
    - 메모리가 아닌 레지스터에 일시적 저장
      -> 레지스터에 접근하는 것이 메모리에 접근하는 것 보다 빠름
    - 플래그
      - 양수와 음수의 구분을 위해 사용
      - 오버플로우 : 레지스터보다 연산 결과가 큰 상황
    
    - 플래그 종류
      - 부호 플래그
      - 제로 플래그
      - 캐리 플래그
      - 오버플로우 플래그
      - 슈퍼바이저 플래그
    
    - 플래그의 저장
      - 플래그 레지스터라는 레지스터에 저장

- 제어 장치
  - 제어장치 : 제어 신호 출력, 명령어 해석

    - Input
      - 클럭 신호 input
        - 클럭 : 컴퓨터의 모든 부품을 일사불란하게 움직일 수 있게 하는 시간 단위
      
      - 명령어 input
        - cpu가 해석해야할 명령어는 명령어 레지스터에 저장
      
      - 플래그 레지스터 속 플래그 값 input
        - 플래그 값을 받아 제어 신호 output

      - 시스템 버스, 그중 제어 버스로 전달된 제어 신호 input
      
    - Output
      - CPU 외부에 전달하는 제어 신호
      - CPU 내부에 전달하는 제어 신호
      

### 레지스터
- 레지스터 종류
  - 프로그램 카운터
    - 메모리에서 가져올 명령어의 주소 저장
    - 명령어 카운터로 부르는 cpu도 있음
    
  - 명령어 레지스터
    - 해석할 명령어, 즉 메모리에서 읽어 들인 명령어 저장
    
  - 메모리 주소 레지스터
    - 메모리 주소 저장
  
  - 메모리 버퍼 레지스터 == 메모리 데이터 레지스터
    - 메모리와 주고받을 값 저장
    
  - 플래그 레지스터
    - ALU 연산 결과에 따른 플래그 저장 
  
  - 범용 레지스터
    - 일반적인 상황에서 자유롭게 사용 가능한 레지스터 
  
  - 스택 포인터
    - 스택 주소 지정 방식에 사용
      - 스택 주소 지정 방식 : 스택과 스택 포인터를 이용한 주소 지정 방식
      - 스택 포인터 : 스택의 꼭대기를 가리키는 레지스터
      - 스택 위치 == 메모리 내부 영역 == 스택 영역
    
    - 변위 주소 지정 방식
      - 오퍼랜드 필드의 값과 특정 레지스터의 값을 더해 유효 주소 추출
      
      - 상대 주소 지정 방식
        - 오퍼랜드와 프로그램 카운터의 값을 더해 유효 주소 추출
        
      - 베이스 레지스터 지정 방식
        - 오퍼랜드와 베이스 레지스터의 값을 더하여 유효 주소 추출
          - 베이스 레지스터 : 기준 주소
          - 오퍼랜드 : 기준 주소로부터 떨어진 거리 
    
      

### 명령어 사이클과 인터럽트
- 명령어 사이클 : 하나의 명령어를 처리하는 정형화된 흐름
- 인터럽트 : 흐름에 따라 명령어를 처리해 나가는 중에 흐름이 끊어지는 상황

- 명령어 사이클
  - 인출 사이클 : 명령어를 CPU로 가지고 오는 단계
  - 실행 사이클 : CPU로 가져온 명령어를 실행하는 단계
  - 간접 사이클 : 명령어를 인출하여 CPU로 가져왔는데 곧 바로 실행할 수 없는 경우 메모리 접근을 한번 더 하는 단계

- 인터럽트
  - 종류
    - 동기 인터럽트 : CPU에 의해 발생하는 인터럽트
      - 예외라고 부름
      
    - 비동기 인터럽트 : 입출력장치에 의해 발생하는 인터럽트
      - 일반적으로 비동기 인터럽트를 인터럽트라고 칭하기도 함
      - 책에서는 혼동을 방지하기 위해 하드웨어 인터럽트라는 용어를 사용

- 하드웨어 인터럽트 처리 순서
  - 입출력장치 > CPU 인터럽트 요청 신호
  - CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부 확인
  - CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 수용 여부 판단
  - 인터럽트를 받아들일 수 있다면 현재까지의 작업을 백업
  - CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴 실행
    - 인터럽트 서비스 루틴 : 인터럽트를 처리하기 위한 프로그램 == 인터럽트 핸들러
    - 인터럽트 벡터 : 인터럽트 서비스 루틴을 식별하기 위한 정보
  - 인터럽트 서비스 루틴 실행 종료 시 백업해 둔 작업 복구 및 실행 재개

- CPU가 인터럽트 요청을 수용하기 위해선 플래그 레지스터의 인터럽트 플래그 활성화 필요


- 예외의 종류
  - 폴트 : 예외를 처리한 직후 예외가 발생한 명령어부터 실행을 재개하는 예외
  - 트랩 : 예외를 처리한 직후 예외가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외
  - 중단 : CPU가 실행 중인 프로그램을 강제로 중단시킬 수 밖에 없는 심각한 오류 발생시 발생하는 예외
  - 소프트웨어 인터럽트 : 시스템 호출이 발생했을 때 나타남