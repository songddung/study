# chapter 2.4 ~ 3.2

## 키워드
- 스위치 : 포트별로 콜리전 도메인을 나누며 전이중 모드 통신을 지원하는 데이터 링크 계층의 장비
  - MAC 주소 테이블로 MAC 주소를 학습해 원하는 포트로 패킷을 포워딩하고 원치 않는 포트를 필터링 할 수 있음

- VLAN : 스위치로 만들 수 있는 가상의 LAN
  - 포트 기반과 MAC 기반으로 나누어 짐

- 네트워크 계층 : 패킷의 최적 이동경로를 결정하는 라우팅이 이루어짐
- IP는 네트워크 계층의 핵심 프로토콜, IP 주소 지정과 IP단편화를 수행
- IP주소를 이용해 호스트 식별 가능
- IPv4와 IPv6 각각 주소의 길이와 헤더의 구성이 다름
- ARP는 동일 네트워크 내에 있는 호스트 IP주소를 통해 MAC주소를 알아내기 위한 프로토콜


- 클래스풀 주소 체계 : 클래스를 이용해 네트워크 주소와 호스트 주소를 나누는 방식
- 클래스리스 주소 체계 : 클래스를 이용하지 않고 서브넷 마스크로 네트워크 주소와 호스트 주소를 구분 짓는 방법
- 서브넷 마스크 : 서브넷을 구분하기 위해 사용하는 비트열, 네트워크 주소는 1, 호스트 주소는 0으로 표현
- IP주소에는 공인 IP 주소와 사설 IP 주소가 있음
- NAT : IP 주소를 변환하는 기술
- 정적으로 할당되는 정적 IP 주소와 동적으로 할당되는 동적 IP 주소가 있음
  - 동적할당의 대표 프로토콜 : DHCP


### 스위치
- 스위치 : 데이터 링크 계층의 네트워크 장비
  - 2계층에서 사용한다 하여 L2스위치라고도 부름
  - 여러 표트에 호스트 연결가능(허브와 유사)
- 허브와 다른점
  - MAC주소를 학습해 특정 MAC 주소를 가진 호스트에만 프레임을 전달할 수 있고, 전이중 모드로 통신 지원
  - 포트별로 콜리전 도메인이 나뉘고, 전이중 모드로 통신하기 때문에 CSMA/CD 프로토콜이 필요하지 않음

- 특징
  - MAC 주소 학습
    - 특정 포트와 해당 포트에 연결된 호스트의 MAC주소와의 관계를 기억함
    - 원하는 호스트에만 프레임을 전달할 수 있음
  - MAC 주소 테이블
    - MAC 주소 학습을 위해 포트와 연결된 호스트의 MAC 주소 간의 연관 관계를 메모리에 표 형태로 기억함
    - 스위치의 포트와 연결된 호스트의 MAC주소 연관 관계를 나타내는 정보를 MAC 주소 테이블이라고 부름

### MAC 주소 학습
- 플러딩 : 스위치가 허브처럼 송신지 포트를 제외한 모든 포트로 프레임 전송
  
- 포워딩과 필터링
  - 필터링 : 전달 받은 프레임을 어디로 내보내고 어디로 내보내지 않을지 결정하는 스위치의 기능
  - 포워딩 : 프레임이 전송될 포트에 실제로 프레임을 내보내는 것

- 에이징 : MAC 주소 테이블에 등록된 특정 포트에서 일정 시간 동안 프레임을 전송받지 못했다면 해당 항목 삭제 

### VLAN
- Virture LAN의 줄임말
- 한 대의 스위치로 가상의 LAN을 만드는 방법
- LAN에 속할 필요가 없는 호스트가 존재 할 경우 이들을 분리하고자 구성
- 여러대의 스위치가 있는 것처럼 논리적인 단위로 LAN 구획 가능
- VLAN사이의 통신에는 네트워크 계층 이상의 상위 계층 장비가 필요
- 브로드캐스트 도메인이 달라짐 => 서로 다른 네트워크로 간주

- 포트 기반 VLAN
  - 특정 포트에 VLAN할당, 호스트에 연결하여 VLAN에 포함

- 트렁크 포트로 전달 받은 프레임이 어떤 VLAN에 속하는지 파악하는 방법
  - 어떤 VLAN에 속하는지 식별하기 위한 정보까지 추가된 확장된 이더넷 프레임 사용 => 802.1Q 프레임
  
- MAC 기반 VLAN
  - MAC 주소에 따라 VLAN이 결정됨

- VLAN 트렁킹 : 두 대 이상의 VLAN 스위치를 효율적으로 연결하는 방식
- 태그 포트라고도 부름
- 하나의 VLAN이 할당된 일반적인 포트는 엑세스 포트라고 부름
- 

### 브리지
- 스위치와 유사한 장비
- 네트워크 영역을 구획하여 콜리전 도메인을 나누거나, 네트워크를 확장하는 용도로 사용
- 스위치의 기능들도 제공
  - MAC 주소 학습
  - 특정 호스트가 연결된 포트로 프레임 포워딩, 필터링 가능
- 사용 빈도가 줄어드는 추세 스위치가 성능에서 더 우수


## 네트워크 계층
- LAN을 넘어서는 다른 네트워크와 통신하기 위해서는 네트워크 계층의 역할이 필수
- IP를 이용하여 송수신지 대상을 지정
- 다른 네트워크에 이르는 경로를 결정하는 라우팅을 통해 다른 네트워크와 통신

- 데이터 링크 계층의 한계
  - 물리 계층과 데이터 링크 계층만으로는 다른 네트워크까지의 도달 경로를 파악하기 어렵다
    - 라우팅 : 패킷의 전송경로중 최적의 경로를 결정하는 것
    - 물리 계층과 데이터 링크계층에서는 라우팅 불가능, 네트워크 계층의 장비로는 가능
      - 대표적인 장비 : 라우터

- MAC 주소만으로 모든 네트워크에 속한 호스트의 위치를 특정하기 어렵다
  - 택배의 수신인 역할: MAC주소, 수신지 역할 : IP주소
  - 두가지 모두 활용하지만  IP주소를 우선으로 활용
  - DHCP 프로토콜을 통해 IP주소를 자동으로 할당받거나, 직접 할당
    - 한 호스트가 복수의 IP주소를 가질 수도 있음
    
- 인터넷 프로토콜
  - 네트워크 계층의 가장 핵심적인 프로토콜
  - IPv4와 IPv6 두가지 버전 존재
  - 일반적인 IP주소 == IPv4

  - IP 주소 형태
    - 4바이트로 주소를 표현
    - 0 ~ 255 범위 안에 있는 4 개의 10진수로 표현, 각10진수는 (.)으로 구분
    - 구분된 8비트를 옥텟 이라고 함

  - IP의 기능
    - IP 주소 지정과 IP단편화
    - IPv4를 정의한 인터넷 표준 문서 : RFC 791

  - IP 주소 지정 : IP 주소를 바탕으로 송수신 대상을 지정
  - IP 단편화 : 전송하고자 하는 패킷의 크기가 MTU라는 최대 전송 단위보다 클 경우, 이를 MTU 크기 이하의 복수의 패킷으로 나누는 것을 의미
  - MTU : 한 번에 전송 가능한 IP 패킷의 최대 크기
    - 1500바이트
    - 쪼개진 패킷은 수신지에 도착 시 다시 재조합

 - IPv4의 형태
   - 핵심 필드
     - 식별자 : 패킷에 할당된 번호
       - 쪼개진 패킷을 재조합 시 식별자로 사용
   
     - 플래그 : 세 개의 비트로 구성된 필드
       - 첫 번째 비트 : 항상 0, 현재 사용X
       - 나머지 비트 중에서 하나는 DF라는 이름이 붙은 비트 (Don't Fragment) == 이 값이 1이라면 IP단편화 수행 X
         - DF가 1이어도 패킷의 크기가 크다면 폐기되고 쪼개짐
       - MF (More Fragment) : 단편화된 패킷이 더 있는지 나타냄 == 이 값이 0이라면 마지막 패킷임을 의미
       
     - 단편화 오프셋
       - 패킷이 단편화되기 전에 패킷의 초기 데이터에서 몇 번째로 떨업진 패킷인지를 나타냄
       - 단편화된 패킷들은 순서대로 들어오지 않을 수 있음
       
     - TTL
       - Time To Live : 패킷의 수명
       - 라우터를 거칠 때마다 TTL이 1씩 감소, 0이되면 폐기
       - 홉(hop) : 패킷이 호스트나 라우터에 한 번 전달되는 것
       
     - 프로토콜
       - IP 패킷의 프로토콜은 상위 계층의 프로토콜이 무엇인지를 나타내는 필드
       
     - 송신지 IP주소
     - 수신지 IP주소

 - IPv6
   - IPv4의 주소는 2^32로 약43억개 > 부족함
   - 이를 해결하기 위해 IPv6 등장
   - 16바이트로 주소를 표현 > 2^128개
   - IPv4에 비해 간소화 > 다음 헤더, 홉 제한, 송,수신지 IP주소

    - 주요 필드
      - 다음 헤더 : 상위 계층의 프로토콜을 가리키거나 확장 헤더를 가리킴
        - 확장 헤더 : 추가적인 헤더 정보가 필요한 경우 사용 
      
      - 홉 제한 : TTL 필드와 비슷하게 패킷의 수명을 나타내는 필드
      - 송,수신지 IP 주소


 - ARP
   - IP주소를 통해 MAC주소를 알아내는 프로토콜 > 동일 네트워크

   - 동작 과정
     - 요청 : 필요한 IP주소에 MAC 주소 요청
     - 응답 : 요청한 MAC주소를 응답 
     - 테이블 갱신 
       - ARP 테이블 : IP주소와 MAC주소의 연관관계를 저장하는 테이블
     
 - IP 단편화를 피하는 방법
   - IP 단편화 없이 주고 받을수 있는 최대 크기만큼 전송 > 이 크기를 경로 MTU라고 함
   - 경로 MTU 발견 : 경로 MTU를 구하고 해당 크기만큼만 송수신하여 IP 단편화를 회피하는 기술


### IP 주소
- 네트워크 주소
  - 네트워크ID, 네트워크 식별자 등으로 부르기도 함
- 호스트 주소
  - 호스트 ID, 호스트 식별자 등으로 부르기도 함

- IP 주소의 클래스
  - 클래스 : 네트워크 크기에 따라 IP 주소를 분류하는 기준
  - 클래스풀 주소 체계 : 클래스를 기반으로 IP 주소를 관리하는 주소 체계
  - 클래스리스 주소 체계 : 클래스풀 주소 체계보다 더 유동적이고 정교하게 네트워크를 구획

    
- 서브넷 마스크
  - IP 주소상에서 네트워크 주소는 1, 호스트 주소는 0 으로 표기한 비트열
  - 서브넷 마스크를 이용해 클래스를 원하는 크기로 더 잘게 쪼개어 사용하는 것을 서브네팅이라고 함

- 공인 , 사설 IP 주소
  - 공인 IP 주소 : 전 세계에서 고유한 IP 주소
    - ISP나 공인 IP 주소 할당 기관에서 할당받을 수 있음
    
  - 사설 IP 주소 : 사설 네트워크에서 사용하기 위한 IP 주소
    - 할당 주체 : 라우터
    - NAT : IP 주소를 변환하는 기술

- 정적 IP 주소와 동적 IP 주소
  - 정적 할당 : 호스트에 직접 수작업으로 IP 주소 부여
  - 동적 할당 : 수동으로 입력하지 않아도 호스트에 동적으로 IP가 할당되는 방식
    - 대표적인 프로토콜 : DHCP
      - 할당 받ㅇ느 IP 주소의 사용기간이 정해져있음


- 루프백 주소 : 자기 자신을 가리키는 특별한 주소 > 로컬호스트라고도 부름
- 디폴트 라우트 : 패킷을 어떤 IP주소로 전달할지 결정하기 어려운 경우 기본적으로 패킷을 전달할 경로를 의미